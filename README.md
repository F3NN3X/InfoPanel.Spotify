# SpotifyPlugin for InfoPanel

A plugin for InfoPanel to display real-time Spotify track information, including track name, artist, album, cover URL, elapsed time, and remaining time.

## Features

- Displays current track details: title, artist, album, cover art URL, elapsed/remaining time, and progress percentage.
- Configurable title truncation via `MaxDisplayLength` in `.ini` file (default: 20 characters).
- Robust pause, resume, and track end detection with visual indicators.
- Optimized API usage with caching and rate limiting (180 req/min, 10 req/s).
- PKCE authentication with Spotify Web API for secure token management.

## Requirements

- .NET 8.0
- InfoPanel application
- Spotify API client ID and **redirect URI** (see instructions below on how to obtain these)
- Dependencies: `SpotifyAPI.Web`, `IniParser`

## Installation

1. **Build**: Compile `InfoPanel.Spotify.csproj` to generate `InfoPanel.Spotify.dll`.
2. **Install**: Place the compiled `.dll`'s in InfoPanelâ€™s plugin directory in a folder called InfoPanel.Spotify. This directory is typically found in the InfoPanel application's data directory.
3. **Configure**: On first run, the plugin creates `InfoPanel.Spotify.dll.ini`. You **must** replace `<your-spotify-api-key>` with your Spotify API client ID and configure the Redirect URI (see below).
4. **Authenticate**: After configuring your API key and redirect URI, run InfoPanel. Follow the browser prompt to authorize the plugin with Spotify. This process will generate a refresh token that will be saved in your `.ini` file. If the refresh token has expired, the Spotify auth will reopen in you browser. Do not edit this token manually.


## Obtaining Your Spotify API Key and Redirect URI

This plugin uses the Spotify Web API's PKCE authentication flow. To use this plugin, you'll need to register an application on the Spotify Developer Dashboard:

1. **Go to the Spotify Developer Dashboard:** Visit [https://developer.spotify.com/dashboard/](https://developer.spotify.com/dashboard/). You may need to create a Spotify account if you don't already have one.
2. **Create a New App:** Click the "Create App" button.
3. **Fill Out the Application Details:** Provide a name and description for your app. You can choose any name and description; they don't directly affect the plugin's functionality.
4. **Redirect URI:**  **This is crucial.** Enter `http://localhost:5000/callback`  in the Redirect URIs field.  This is the callback URL used by the embedded authentication server.
5. **Save and Get Your Client ID:** After creating the app, you'll find your "Client ID" in the app's dashboard. **Copy this Client ID**.
6. **Configure Your Plugin:**  Paste the copied "Client ID" into your `InfoPanel.Spotify.dll.ini` file under `APIKey`.

## Usage

- Activate the plugin in InfoPanel.
- Play music in Spotify; track details will appear in the InfoPanel UI.

## Configuration

Edit `InfoPanel.Spotify.dll.ini`:

```ini
[Spotify Plugin]
APIKey=<your-spotify-api-key>  // Obtained from the Spotify Developer Dashboard
MaxDisplayLength=20             // Optional: Adjust the maximum number of characters displayed for track, artist, and album names.
RefreshToken=<auto-generated>  // Do not modify this; it's automatically generated during authentication.
